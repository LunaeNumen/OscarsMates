<main class="categories-page">
  <div class="container mx-auto px-4 py-8">
    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between categories-header">
      <div>
        <h1 class="page-title mb-0">Categories</h1>
        <p class="text-secondary mb-0"><%= current_year %> Academy Awards</p>
      </div>

      <div class="flex flex-wrap items-center gap-3">
        <form class="search-form" role="search" action="<%= categories_path(year: current_year) %>" method="get">
          <i data-lucide="search" class="search-icon"></i>
          <input class="search-input"
                 type="search"
                 name="query"
                 placeholder="Search..."
                 aria-label="Search"
                 value="<%= params[:query] %>">
        </form>

        <% if current_user_admin? %>
          <%= link_to new_category_path(year: current_year), class: "btn-oscar btn-sm" do %>
            <i data-lucide="plus" class="text-muted"></i>
          <% end %>
        <% end %>
      </div>
    </div>

    <% if @categories.any? %>
      <div class="categories-list">
        <% @categories.each do |category| %>
          <% category_movies = category.movies.for_year(current_year).limit(4) %>
          <% if category_movies.any? %>
            <div class="category-row">
              <!-- Category name column (4/12 columns) -->
              <div class="category-name-column">
                <div class="category-title-row">
                  <div class="category-icon-wrapper">
                    <i data-lucide="trophy" class="category-icon"></i>
                  </div>
                  <div class="category-title-wrapper">
                    <h2 class="category-title"><%= category.name %></h2>
                  </div>
                </div>
                <p class="text-base text-muted m-0 category-count-text"><%= pluralize(category.movies.for_year(current_year).count, 'movie') %></p>
              </div>

              <!-- Movies grid column (8/12 columns) -->
              <div class="category-movies-column">
                <% category_movies.each do |movie| %>
                  <div class="category-movie-card">
                    <%= render 'movies/movie_card', movie: movie, review: @user_reviews[movie.id] %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    <% else %>
      <div class="empty-state">
        <div class="empty-icon">
          <i data-lucide="award" class="text-muted"></i>
        </div>
        <h3>No categories found</h3>
        <p>
          <% if params[:query].present? %>
            No results for "<%= params[:query] %>".
          <% else %>
            No categories available yet.
          <% end %>
        </p>
        <% if params[:query].present? %>
          <%= link_to "Clear", categories_path(year: current_year), class: "btn-oscar btn-sm" %>
        <% end %>
      </div>
    <% end %>
  </div>
</main>
